# Домашнее задание к занятию "6.1. Типы и структура СУБД"

## Введение

Перед выполнением задания вы можете ознакомиться с 
[дополнительными материалами](https://github.com/netology-code/virt-homeworks/tree/master/additional/README.md).

## Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определенных данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- Электронные чеки в json виде
- Склады и автомобильные дороги для логистической компании
- Генеалогические деревья
- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации
- Отношения клиент-покупка для интернет-магазина

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

### Ответ
- Электронные чеки в json виде. Для этой задачи подходит Документно-ориентированная NoSQL СУБД, где каждому номеру чека (ключу) будет соответствовать запись его содержимого, как значение. Получается схема Ключ-значение. 
- Склады и автомобильные дороги для логистической компании. Такой задаче, пожалуй лучше всего соответстует схема NoSQL Графовой СУБД, где Элементы типа Склады могут быть связаны между собой произвольным количеством дорог разного типа, длинны и т.д. 
- Генеалогические деревья лучше всего хранить в NoSQl Иерархической СУБД, в которой предусмотрено отношение Родитель - Множество потомков. Такая схема как раз соответствует схеме генеалогического древа.
- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации можно хранить в NoSQL СУБД типа Ключ-Значение. 
- Отношения клиент-покупка для интернет-магазина. Такая модель данных требует хранения в реляционной SQL СУБД. Где, произвольное количество клиентов связаны с произвольным кол-вом  "чеков" о покупке или заказов, которые содержат данные о количестве каждого товара, а значит связаны с товарами.


## Задача 2

Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

- Данные записываются на все узлы с задержкой до часа (асинхронная запись)
- При сетевых сбоях, система может разделиться на 2 раздельных кластера
- Система может не прислать корректный ответ или сбросить соединение

А согласно PACELC-теореме, как бы вы классифицировали данные реализации?

### Ответ
Если:
- Данные записываются на все узлы с задержкой до часа (асинхронная запись)

По классификации CAP это будет не согласованная система, то есть AP.
А по PACELC это будет PA/EC.

- При сетевых сбоях, система может разделиться на 2 раздельных кластера

Если я правильно понимаю, то если система разделяется на 2 кластера, то предполагается, что каждый из них собирается работать автономно, а значит система не устойчива к разделению.
то есть по классификации CAP это будет видимо AC. 
А по PACELC такая система вообще не имеет права на существование. 

- Система может не прислать корректный ответ или сбросить соединение.

По классификации CAP это будет CP, то есть у такой системы отсутствует гарантированная Доступность. 
А по PACELC это будет PC/EC или PC/EL.


## Задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

### Ответ
Резюмируем информацию о ACID и  BASE
ACID - требования к СУБД, в обеспечение надежности и предсказуемости ее работы.
- A - atomicity (атомарность) никакая транзакция не будет зафиксирована в БД частично.
- C - consistency (согласованность) каждая успешная транзакция фиксирует только допустимые результаты.
- I - isolation (изоляция) параллельные транзакции не искажают результат друг друга.
- D - durability (стойкость) гарантия применения успешных транзакций, независимо от низкоуровневых проблем.
ACID позволяет проектировать высоконадежные системы.

BASE - принцип, противопоставляющий себя ACID.
- BA - basically availability (базовая доступность) деградация части узлов ведет к деградации части сессий, исключая полную деградацию системы. Система отвечает на любой запрос, но в ответе могут быть неверные данные.
- S - soft state (неустойчивое состояние) уменьшение времени хранения сессий и фиксация обновлений только критичных операций. 
- E - eventually consistent (конечная согласованность) изменение состояния в конечном итоге применится на все системы
BASE позволяет проектировать высокопроизводительные системы.

На сколько я понимаю, эти два принципа противоречат друг другу и не возможно создать систему, которая бы удовлетворяла обоим это объясняется теоремой CAP.

Реализация ACID требует полной согласованности, жертвой чего становится производительность, а также возможность не получить ответ на запрос, а BASE может находиться в недосогласованном состоянии некоторое время, но зато сразу и всегда отвечает на запросы, правда не всегда данные верны.

Совместить два этих принципа не возможно в рамках одной СУБД, но, мне кажется, что в рамках одной информационной системы можно сделать какую-то комбинацию из нескольких СУБД, которая будет в целом чем-то средним между ними или даже удовлетворять обоим принципам. Пример привести не могу. 

## Задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни
- реакция на истечение таймаута

Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). 
Что это за система? Какие минусы выбора данной системы?

### Ответ
Самым распростанённым решением для key-value хранилища, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/) является `Redis`.

Если говорить о минусах выбора Redis в качестве системы для реализации pub/sub то можно сказать, что этот функционал разработчиками Redis был не до конца продуман. Основной проблемой является отсутствие механизма очередей для отправки сообщений подписчикам в результате чего:
- подписчик может получить большое число сообщений одновременно и не успевать их обрабатывать
- некоторые подписчики могут не получить сообщение вовсе
- вероятно возможны ситуации когда порядок сообщений пришедших на клиента может нарушаться
- нет контроля доставки сообщений
Возможно также, что при падении сервера все подписки потеряются и клиенты перестанут получать сообщения.

Одним словом, кажется,что Redis - не удачное решение для функционала pub/sub. 

---

### Как cдавать задание

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---